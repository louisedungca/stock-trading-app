<% content_for :header do %>
  <div class="flex justify-between w-full">
    <div class="flex gap-3 items-center w-2/3">
      Trade Stocks
      <p class="text-base text-gray-500">
        Trade Responsibly
      </p>
    </div>

    <div class="w-1/3 form__wrapper px-0">
      <%= form_tag(trader_trade_path, method: :get) do %>
        <div class="flex justify-center gap-2 w-full">
          <div class="field flex-col lg:flex-row gap-2 w-full items-center">
            <svg class="w-6 h-6 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
              <path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="m21 21-3.5-3.5M17 10a7 7 0 1 1-14 0 7 7 0 0 1 14 0Z"/>
            </svg>
            <%= text_field_tag :stock_symbol, params[:stock_symbol], placeholder: "Enter Stock Symbol", class:"w-full text-xs" %>    
        </div>
            
          <%= submit_tag "Search", class:"text-xs button--main cursor-pointer" %>
        </div>
      <% end %>
    </div>
  </div>  
<% end %>

<div class="h-full flex flex-col gap-4">  
  <%= render 'pages/widgets/ticker' %>

  <div class="flex gap-1 w-full h-full">
    <aside class="h-full <%= @data.present? ? "w-1/4" : "w-1/2" %>">
      <%= render 'pages/widgets/stock_market' %>
    </aside>

    <div class="flex flex-col gap-1">
      <% if @data %> 
        <%= render 'pages/widgets/fixed_chart', locals: { stock_symbol: @stock_symbol } %>

        <div class="flex gap-1 h-1/4 w-full">  
          <div class="bg--frosted py-2 px-4 flex flex-col gap-2 items-center justify-around w-full">
            <!-- ** STOCK DETAILS ** -->
            <div class="w-full flex flex-col gap-1 border-b-2 border-gray-400 py-2">
              <div class="font-sans tracking-widest font-bold text-xl flex gap-2 divide-x-2 divide-gray-600">
                <h1 class="text-violet-100"><%= @stock_symbol %></h1> 
                <h1 class="font-medium pl-2"><%= @data.company_name %></h1> 
              </div>

              <small class="flex gap-2 items-center font-bold text-violet-200">
                <span class="font-sans text-xs font-light ">Latest Price:</span>         
                <%= format_currency(@data.latest_price, unit: "$") %>  
              </small>
            </div>

            <!-- ** FORMS ** -->
            <div class="h-fit w-auto flex gap-2 py-2 divide-x-2 divide-gray-600 text-sm">
              <!-- ** BUY FORM ** -->
              <div class="px-8 py-2">
                <h1 class="p-3.5 text-base font-sans font-bold tracking-widest uppercase">Buy Stocks</h1>
                <%= form_with(url: trader_trade_buy_path, method: :post1) do |form| %>
                  <div class="form__wrapper gap-2 items-center">
                    <div class="field gap-2 flex-row items-center w-full">
                      <%= form.hidden_field :stock_symbol, value: params[:stock_symbol] %>
                      <%= form.label :shares, "Share Qty:", class: "w-1/2" %>
                      <%= form.number_field :shares, min: 0, step: 0.01, class: "w-full" %>
                    </div>
                      <%= form.button 'Buy', class:"button--main w-full mt-3" %>
                  </div>
                <% end %>
              </div>

              <!-- ** SELL FORM ** -->
              <div class="px-8 py-2">
                <h1 class="p-3.5 text-base font-sans font-bold tracking-widest uppercase">Sell Stocks</h1>
                <%= form_with(url: trader_trade_sell_path, method: :post) do |form| %>
                  <div class="form__wrapper gap-2 items-center">
                    <div class="field gap-2 flex-row items-center w-full">
                      <%= form.hidden_field :stock_symbol, value: params[:stock_symbol] %>
                      <%= form.label :shares, "Share Qty:", class: "w-1/2" %>
                      <%= form.number_field :shares, min: 0, step: 0.01, class: "w-full" %>
                    </div>
                      <%= form.button 'Sell', class:"button--main w-full mt-3" %>
                  </div>
                <% end %>
              </div>
            </div>     

          </div>   
        </div>   
      <% end %> 
    </div>

    <aside class="h-full <%= @data.present? ? "w-1/4" : "w-1/2" %>">
    <% if @data %>
      
      <div class="h-full flex flex-col">
        <%= render 'pages/widgets/symbol_info', symbol: @stock_symbol %>
        <%= render 'pages/widgets/tech_analysis', symbol: @stock_symbol %>
      </div>
      
    <% else %>
      <%= render 'pages/widgets/top_news' %>
    <% end %>
      
    </aside>
  </div>
  
</div>

